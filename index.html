// REPLACE THIS FUNCTION IN YOUR CODE:

async function uploadFileSync(taskId, fileInput) {
    if (!fileInput.files || fileInput.files.length === 0) return;

    const file = fileInput.files[0];

    try {
        const formData = new FormData();

        // ‚úÖ CORRECT: Use hardcoded item_id and column_id (not variables)
        const query = `
            mutation add_file($file: File!) {
                add_file_to_column(
                    item_id: ${taskId},
                    column_id: "${COLUMNS.FILES}",
                    file: $file
                ) {
                    id
                }
            }
        `;

        formData.append('query', query);
        
        // Map for multipart upload
        const map = {
            "0": ["variables.file"]
        };
        formData.append('map', JSON.stringify(map));
        
        // The actual file
        formData.append('0', file, file.name);

        console.log('üìé Uploading file:', file.name);
        console.log('üìé Task ID:', taskId);

        // ‚úÖ Use /v2/file endpoint for file uploads
        const response = await fetch('https://api.monday.com/v2/file', {
            method: 'POST',
            headers: {
                'Authorization': API_KEY
            },
            body: formData
        });

        const data = await response.json();
        console.log('üìé File upload response:', data);

        if (!response.ok) {
            throw new Error(data?.error_message || data?.errors?.[0]?.message || `HTTP ${response.status}`);
        }

        if (data.errors) {
            console.error('File upload error:', data.errors);
            throw new Error(data.errors[0].message);
        }

        fileInput.value = '';
        console.log('‚úÖ File uploaded successfully!');
        
    } catch (error) {
        console.error('‚ùå Error uploading file:', error);
        throw error;
    }
}
